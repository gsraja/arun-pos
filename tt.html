<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <head>
        <script>
            var ast = {"type":"Block","nodes":[{"type":"Code","val":"var a = [1,2,3]","buffer":false,"mustEscape":false,"isInline":false,"line":1,"column":1,"filename":"/Users/gsraja/Documents/alphine/src/test.pug"},{"type":"Code","val":"var b = true","buffer":false,"mustEscape":false,"isInline":false,"line":2,"column":1,"filename":"/Users/gsraja/Documents/alphine/src/test.pug"},{"type":"Mixin","name":"greet","args":"name","block":{"type":"Block","nodes":[{"type":"Tag","name":"h3","selfClosing":false,"block":{"type":"Block","nodes":[{"type":"Text","val":"hello ","line":6,"column":6,"filename":"/Users/gsraja/Documents/alphine/src/test.pug"},{"type":"Code","val":"name","buffer":true,"mustEscape":true,"isInline":true,"line":6,"column":12,"filename":"/Users/gsraja/Documents/alphine/src/test.pug"}],"line":6,"filename":"/Users/gsraja/Documents/alphine/src/test.pug"},"attrs":[],"attributeBlocks":[],"isInline":false,"line":6,"column":3,"filename":"/Users/gsraja/Documents/alphine/src/test.pug"}],"line":6,"filename":"/Users/gsraja/Documents/alphine/src/test.pug"},"call":false,"line":5,"column":1,"filename":"/Users/gsraja/Documents/alphine/src/test.pug"},{"type":"Tag","name":"html","selfClosing":false,"block":{"type":"Block","nodes":[{"type":"Text","val":" ","line":8,"column":5,"filename":"/Users/gsraja/Documents/alphine/src/test.pug"},{"type":"Tag","name":"head","selfClosing":false,"block":{"type":"Block","nodes":[{"type":"Text","val":" ","line":9,"column":7,"filename":"/Users/gsraja/Documents/alphine/src/test.pug"},{"type":"Tag","name":"title","selfClosing":false,"block":{"type":"Block","nodes":[{"type":"Text","val":"title content ","line":10,"column":11,"filename":"/Users/gsraja/Documents/alphine/src/test.pug"}],"line":10,"filename":"/Users/gsraja/Documents/alphine/src/test.pug"},"attrs":[],"attributeBlocks":[],"isInline":false,"line":10,"column":5,"filename":"/Users/gsraja/Documents/alphine/src/test.pug"}],"line":9,"filename":"/Users/gsraja/Documents/alphine/src/test.pug"},"attrs":[],"attributeBlocks":[],"isInline":false,"line":9,"column":3,"filename":"/Users/gsraja/Documents/alphine/src/test.pug"},{"type":"Tag","name":"body","selfClosing":false,"block":{"type":"Block","nodes":[{"type":"Text","val":" ","line":11,"column":7,"filename":"/Users/gsraja/Documents/alphine/src/test.pug"},{"type":"Conditional","test":"b","consequent":{"type":"Block","nodes":[{"type":"Tag","name":"h1","selfClosing":false,"block":{"type":"Block","nodes":[{"type":"Text","val":"content","line":13,"column":27,"filename":"/Users/gsraja/Documents/alphine/src/test.pug"}],"line":13,"filename":"/Users/gsraja/Documents/alphine/src/test.pug"},"attrs":[{"name":"att","val":"\"attrvalue\"","line":13,"column":10,"filename":"/Users/gsraja/Documents/alphine/src/test.pug","mustEscape":true}],"attributeBlocks":[],"isInline":false,"line":13,"column":7,"filename":"/Users/gsraja/Documents/alphine/src/test.pug"}],"line":13,"filename":"/Users/gsraja/Documents/alphine/src/test.pug"},"alternate":null,"line":12,"column":5,"filename":"/Users/gsraja/Documents/alphine/src/test.pug"},{"type":"Each","obj":"a","val":"k","key":null,"block":{"type":"Block","nodes":[{"type":"Tag","name":"p","selfClosing":false,"block":{"type":"Block","nodes":[{"type":"Code","val":"k","buffer":true,"mustEscape":true,"isInline":true,"line":15,"column":8,"filename":"/Users/gsraja/Documents/alphine/src/test.pug"}],"line":15,"filename":"/Users/gsraja/Documents/alphine/src/test.pug"},"attrs":[],"attributeBlocks":[],"isInline":false,"line":15,"column":7,"filename":"/Users/gsraja/Documents/alphine/src/test.pug"},{"type":"Tag","name":"a","selfClosing":false,"block":{"type":"Block","nodes":[{"type":"Text","val":"hello ","line":16,"column":9,"filename":"/Users/gsraja/Documents/alphine/src/test.pug"},{"type":"Code","val":"k","buffer":true,"mustEscape":true,"isInline":true,"line":16,"column":15,"filename":"/Users/gsraja/Documents/alphine/src/test.pug"},{"type":"Text","val":" world","line":16,"column":19,"filename":"/Users/gsraja/Documents/alphine/src/test.pug"}],"line":16,"filename":"/Users/gsraja/Documents/alphine/src/test.pug"},"attrs":[],"attributeBlocks":[],"isInline":true,"line":16,"column":7,"filename":"/Users/gsraja/Documents/alphine/src/test.pug"},{"type":"Mixin","name":"greet","args":"\"Sathish\"","block":null,"call":true,"attrs":[],"attributeBlocks":[],"line":17,"column":7,"filename":"/Users/gsraja/Documents/alphine/src/test.pug"}],"line":15,"filename":"/Users/gsraja/Documents/alphine/src/test.pug"},"line":14,"column":5,"filename":"/Users/gsraja/Documents/alphine/src/test.pug"}],"line":11,"filename":"/Users/gsraja/Documents/alphine/src/test.pug"},"attrs":[],"attributeBlocks":[],"isInline":false,"line":11,"column":3,"filename":"/Users/gsraja/Documents/alphine/src/test.pug"}],"line":8,"filename":"/Users/gsraja/Documents/alphine/src/test.pug"},"attrs":[],"attributeBlocks":[],"isInline":false,"line":8,"column":1,"filename":"/Users/gsraja/Documents/alphine/src/test.pug"}],"line":0,"filename":"/Users/gsraja/Documents/alphine/src/test.pug","declaredBlocks":{}}

            processNode(ast)
            function processNode(node)
{
    
   
    if (node.type == 'Conditional') { 
        Object.assign(node, {
            type: 'Tag',
            name: 'template',
            selfClosing: false,
            block: node.consequent,
            attrs: [{
                name: 'x-if',
                val: `"${node.test}"`,
                mustEscape: false,
            }],
            attributeBlocks: [], 
            isInline: false
        });
        delete node.test;
        delete node.consequent;
        delete node.alternate;
    } else if (node.type == 'Each') {
        
        var f = "";
        if (node.key) {
            f = `"(${node.val}, ${node.key}) in ${node.obj}"`
        } else {
            f = `"${node.val} in ${node.obj}"`
        }
        
        Object.assign(node, {
            type: 'Tag',
            name: 'template',
            selfClosing: false,
            attrs: [{
                name: 'x-for',
                val: f,
                mustEscape: false,
            }],
            attributeBlocks: [], 
            isInline: false
        });
        delete node.val;
        delete node.key;
        delete node.obj;
    }



    if (Array.isArray(node.nodes)) {
        for (var n of node.nodes) {
            processNode(n);
        }
    } else if (node.hasOwnProperty('block')) {
        if (node.type == 'Tag') {
            console.log(`${node.type}:${node.name}`)
        } else {
            console.log(`${node.type}`)
        }
        
        if (Array.isArray(node.block.nodes)) {
            var isText = true;
            var hasCode = false;
            for (var n of node.block.nodes) {
                if (n.type == 'Code' && n.buffer == true) {
                    hasCode = true;
                }
                if (['Text', 'Code'].indexOf(n.type) == -1) {
                    isText = false; 
                    break;
                }
            }

            if (isText && hasCode) {
                var xtext = [];
                for (var n of node.block.nodes) {
                    if (n.type == 'Text') {
                        xtext.push(`'${n.val}'`) 
                    } else {
                        xtext.push(n.val)
                    }
                }

                node.attrs.push({
                    name: 'x-text',
                    val: `"${xtext.join(' + ')}"`,
                    mustEscape: false,
                })
                node.block.nodes =[]

            } else {
                processNode(node.block)
            }
        } else {
            processNode(node.block)
        }
    }

}

        </script>
    </head>
</head>
<body>
    
</body>
</html>